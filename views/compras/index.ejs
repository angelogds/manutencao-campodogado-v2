<% layout('layout') %>

<style>
  .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
  .btn{ display:inline-block; padding:10px 12px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; text-decoration:none; font-weight:900; color:#111827; }
  .btn.primary{ background:#0b6b3a; border-color:#0b6b3a; color:#fff; }
  .table{ width:100%; border-collapse:separate; border-spacing:0; background:#fff; border:1px solid #e5e7eb; border-radius:16px; overflow:hidden; }
  .table th,.table td{ padding:12px 12px; border-bottom:1px solid #f1f5f9; text-align:left; font-size:14px; }
  .table th{ font-size:12px; color:#6b7280; text-transform:uppercase; letter-spacing:.04em; }
  .badge{ padding:4px 10px; border-radius:999px; font-size:12px; font-weight:900; border:1px solid #e5e7eb; }
  .b-aberta{ background:rgba(11,107,58,.08); border-color:rgba(11,107,58,.25); color:#0b6b3a; }
  .muted{ color:#6b7280; }
  .filters{ display:flex; gap:8px; flex-wrap:wrap; }
  .input{ padding:10px 12px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; }
</style>

<div class="row">
  <div>
    <h1 style="margin:0;">Compras</h1>
    <p class="muted" style="margin:6px 0 0;">Solicitações da Manutenção para o setor de Compras.</p>
  </div>

  <div class="filters">
    <form method="GET" action="/compras" style="display:flex; gap:8px; align-items:center;">
      <select class="input" name="status">
        <option value="" <%= !status ? "selected" : "" %>>Todos</option>
        <option value="ABERTA" <%= status==="ABERTA" ? "selected" : "" %>>ABERTA</option>
        <option value="EM_COTACAO" <%= status==="EM_COTACAO" ? "selected" : "" %>>EM_COTACAO</option>
        <option value="APROVADA" <%= status==="APROVADA" ? "selected" : "" %>>APROVADA</option>
        <option value="COMPRADA" <%= status==="COMPRADA" ? "selected" : "" %>>COMPRADA</option>
        <option value="RECEBIDA" <%= status==="RECEBIDA" ? "selected" : "" %>>RECEBIDA</option>
        <option value="CANCELADA" <%= status==="CANCELADA" ? "selected" : "" %>>CANCELADA</option>
      </select>
      <button class="btn" type="submit">Filtrar</button>
    </form>

    <a class="btn primary" href="/compras/new">+ Nova Solicitação</a>
  </div>
</div>

<div style="margin-top:14px;">
  <table class="table">
    <thead>
      <tr>
        <th style="width:80px;">ID</th>
        <th>Título</th>
        <th>Setor</th>
        <th>Prioridade</th>
        <th>Status</th>
        <th style="width:160px;">Data</th>
      </tr>
    </thead>

    <tbody>
      <% if (!items || items.length === 0) { %>
        <tr>
          <td colspan="6" class="muted">Nenhuma solicitação encontrada.</td>
        </tr>
      <% } else { %>
        <% items.forEach((s) => { %>
          <tr>
            <td>#<%= s.id %></td>
            <td style="font-weight:900;"><%= s.titulo %></td>
            <td><%= s.setor %></td>
            <td><%= s.prioridade %></td>
            <td>
              <span class="badge <%= s.status === 'ABERTA' ? 'b-aberta' : '' %>"><%= s.status %></span>
            </td>
            <td class="muted"><%= (s.created_at || '').replace('T',' ').slice(0,16) %></td>
          </tr>
        <% }) %>
      <% } %>
    </tbody>
  </table>
</div>
