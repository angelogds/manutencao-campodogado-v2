<% layout('layout') %>

<style>
  .grid{ display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:14px; }
  .card{ background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px; box-shadow:0 10px 26px rgba(0,0,0,.06); }
  .k{ color:#6b7280; font-weight:800; font-size:13px; }
  .v{ font-size:34px; font-weight:900; margin-top:6px; }
  .btn{ display:inline-block; padding:10px 12px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; text-decoration:none; font-weight:900; color:#111827; }
  .btn.primary{ background:#0b6b3a; border-color:#0b6b3a; color:#fff; }
  @media(max-width: 900px){ .grid{ grid-template-columns:1fr; } }
</style>

<h1>Dashboard</h1>
<p style="color:#6b7280; margin-top:-6px;">
  Bem-vindo, <strong><%= user?.nome || "Usuário" %></strong>. Perfil: <strong><%= user?.role || user?.perfil || "USER" %></strong>
</p>

<div class="grid">
  <div class="card">
    <div class="k">OS Abertas</div>
    <div class="v"><%= counters.os_abertas %></div>
    <a class="btn" href="/os?status=ABERTA">Ver OS</a>
    <a class="btn primary" href="/os/new" style="margin-left:8px;">Abrir OS</a>
  </div>

  <div class="card">
    <div class="k">OS em Andamento</div>
    <div class="v"><%= counters.os_andamento %></div>
    <a class="btn" href="/os?status=ANDAMENTO">Acompanhar</a>
  </div>

  <div class="card">
    <div class="k">OS Concluídas</div>
    <div class="v"><%= counters.os_concluidas %></div>
    <a class="btn" href="/os?status=CONCLUIDA">Histórico</a>
  </div>

  <div class="card">
    <div class="k">Compras Pendentes</div>
    <div class="v"><%= counters.compras_pendentes %></div>
    <a class="btn" href="/compras">Ir para Compras</a>
  </div>

  <div class="card">
    <div class="k">Itens no Estoque</div>
    <div class="v"><%= counters.estoque_itens %></div>
    <a class="btn" href="/estoque">Ver Estoque</a>
  </div>

  <div class="card">
    <div class="k">Admin</div>
    <div style="margin-top:10px;">
      <% if ((user?.role || user?.perfil) === "ADMIN") { %>
        <a class="btn" href="/admin/users">Usuários</a>
      <% } else { %>
        <span style="color:#6b7280;">Sem acesso</span>
      <% } %>
    </div>
  </div>
</div>
