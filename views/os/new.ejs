<% layout('layout') %>

<style>
  .card{ max-width:720px; background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px; }
  .grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .field{ display:flex; flex-direction:column; gap:6px; }
  label{ font-weight:900; font-size:13px; color:#374151; }
  input,select,textarea{
    padding:10px 12px;
    border:1px solid #d1d5db;
    border-radius:12px;
    font-size:14px;
    outline:none;
    background:#fff;
  }
  textarea{ min-height:120px; resize:vertical; grid-column:1 / -1; }
  .btn{ padding:12px 14px; border-radius:12px; border:0; background:#0b6b3a; color:#fff; font-weight:900; cursor:pointer; }
  .btn.secondary{
    padding:12px 14px;
    border:1px solid #e5e7eb;
    border-radius:12px;
    text-decoration:none;
    font-weight:900;
    color:#111827;
    background:#fff;
    display:inline-flex;
    align-items:center;
    justify-content:center;
  }
  .hint{ margin-top:6px; font-size:12px; color:#6b7280; }
</style>

<h1>Abrir OS</h1>

<div class="card">
  <form method="POST" action="/os">
    <div class="grid">

      <!-- ✅ SOMENTE UM CAMPO DE EQUIPAMENTO (select) -->
      <div class="field">
        <label for="equipamento_id">Equipamento</label>
        <select id="equipamento_id" name="equipamento_id" required>
          <option value="">Selecione...</option>
          <% (equipamentos || []).forEach((e) => { %>
            <option value="<%= e.id %>">
              [<%= e.setor %>] <%= e.nome %><%= e.codigo ? (" - " + e.codigo) : "" %>
            </option>
          <% }) %>
        </select>

        <% if (!equipamentos || equipamentos.length === 0) { %>
          <div class="hint">
            Nenhum equipamento cadastrado. Cadastre em <a href="/equipamentos">Equipamentos</a>.
          </div>
        <% } %>
      </div>

      <div class="field">
        <label>Tipo</label>
        <select name="tipo">
          <option value="CORRETIVA">CORRETIVA</option>
          <option value="PREVENTIVA">PREVENTIVA</option>
          <option value="NR12">NR12</option>
          <option value="OUTRA">OUTRA</option>
        </select>
      </div>

      <div class="field" style="grid-column:1/-1;">
        <label>Descrição</label>
        <textarea name="descricao" placeholder="Descreva o serviço..." required></textarea>
      </div>
    </div>

    <div style="margin-top:12px; display:flex; gap:10px;">
      <button class="btn" type="submit">Abrir OS</button>
      <a class="btn secondary" href="/os">Cancelar</a>
    </div>
  </form>
</div>
